<div align="center">
  <a href="https://vara.network/" target="blank"><img src="https://raw.githubusercontent.com/Vara-Lab/Assets/refs/heads/main/logos/vara-logo-white.png" width="120" alt="Nest Logo" /></a>
  <img src="https://nestjs.com/img/logo-small.svg" width="120" alt="Nest Logo" />
</div>

<p align="center">A backend server for building dApps with gasless feature on <a href="http://nodejs.org" target="_blank">Vara Network</a></p>

## üìù Description

Nestjs server which enables efficient user of the gasless feature. The server send gasless transactions using a *voucher-based* system (service) and long-polling features.

### Server routes

Server contains three functions that you can call:

1.  `/voucher/create-voucher (POST)`: 
    - Issues a voucher for the given account.
    - It receives a JSON:
      ```json
      {
        "userAddress": "0xa42c..."
      }
      ```
2. `/voucher/update-voucher (POST)`:
    - Update a voucher for the given user address and voucher address
    - The server will check what updates the voucher needs
    - It receives a JSON:
      ```json
      {
        "userAddress": "0xce32f...",
        "voucherId": "0x32cf2..."
      }
      ```
3. `/voucher/voucher-data (GET)`:
    - Get voucher information: balance and if voucher is expired
    - It receives a JSON:
      ```json
      {
        "userAddress": "0xce32f...",
        "voucherId": "0x32cf2..."
      }
      ```
- ``

## üí° Features:

- Supports gasless transactions on Vara Network.
- `Long polling`: The server will hold the request and return a response once it finish a process (create or update a voucher). 
- `Supports multiple requests`: The server stores the requests and processes the batch of requests at the same time, while this occurs, the server can continue receiving requests for further processing. With this feature. With this, you can forget about errores in voucher management, such as nonce errors, etc. 
- Scalable: The server has two main services `SailscallsService` and `VouchersWorkerService`, that enables to you to create more modules in the server and integrate some features like requests update or create vouchers with the voucher worker service, or set a module that send messsages to contracts ussing vouchers using the sailscalls service.
- Tests: The server contains a lot of tests that you can use, it includes k6 tests for load tests, you can extend it to create new tests if you change the server!
- Accepts vouchers generated by Vara-compatible wallets (such as Polkadot.js, Nova Wallet, Subwallet and Talisman).

## üì¶ Tech Stack

- Nest.js
- [SailsCalls](https://github.com/Vara-Lab/SailsCalls) to use all features in vara network in a quickly way.
- `@gear-js/api` for interacting with Vara.

## Getting started

### Install dependencies

```bash
pnpm install
```

### Declare environment variables

Create `.env` file, `.env.example` will let you know what variables are expected.

### Compile and run the project

```bash
# development
$ pnpm run start

# watch mode
$ pnpm run start:dev

# production mode
$ pnpm run start:prod
```

### Run tests

```bash
# unit tests
$ pnpm run test

# e2e tests
$ pnpm run test:e2e

# test coverage
$ pnpm run test:cov
```

##  You can try the Server template on gitpod!

<p align="center">
  <a href="https://gitpod.io/#https://github.com/Vara-Lab/Vara-Gasless-Server.git" target="_blank">
    <img src="https://gitpod.io/button/open-in-gitpod.svg" width="240" alt="Gitpod">
  </a>
</p>


## License

This project is licensed under the MIT License.